import{_ as ee,a as le,b as te,c as se,d as ae}from"./DialogContent.vue.l7y15EQk.js";import{_ as ne}from"./index.a4YEVL34.js";import{i as P,o as u,B as I,w as r,b as c,a as e,d as y,t as o,c as _,f as x,ac as oe,g as Q,F as $,H as D,r as h,x as ie,j as re,ae as ue,L as ce,l as F,af as H,ag as U,ah as de}from"./entry.oc5bmuJu.js";import{_ as ve}from"./Header.vue.4jpNsp7M.js";import{a as _e,b as fe,_ as me}from"./TabsList.vue.5v6cmh6X.js";import{_ as pe}from"./TabsContent.vue.cKn5W946.js";import{g as V}from"./book.Jn-fh3Jt.js";import{u as we}from"./fetch.jhI20Ome.js";const ge={class:"flex flex-col gap-4"},he={class:"flex gap-4"},xe=["src"],ke={class:"flex flex-col gap-4"},ye=e("div",{class:"text-sm font-bold"},"kr",-1),$e=e("div",{class:"text-sm font-bold"},"jp",-1),Be={key:0,class:"flex flex-col gap-1"},Ce=e("div",{class:"text-sm font-bold"},"게시판으로",-1),je={class:"flex flex-col gap-1"},De={class:"text-3xl font-bold"},Ge=P({__name:"namuWiki",props:{open:{type:Boolean},wiki:{},selectedBook:{}},emits:["update:open"],setup(X,{emit:m}){const G=m;return(d,v)=>{const p=ee,w=le,i=te,B=ne,T=se,k=ae;return u(),I(k,{open:d.open,"onUpdate:open":v[1]||(v[1]=f=>G("update:open"))},{default:r(()=>[c(T,{class:"w-full max-w-7xl h-5/6 overflow-y-scroll"},{default:r(()=>[e("div",ge,[c(i,null,{default:r(()=>[c(p,null,{default:r(()=>[y("만화 상세")]),_:1}),c(w,null,{default:r(()=>[y(" 해당 내용은 나무위키에서 발췌한 것입니다. ")]),_:1})]),_:1}),e("div",he,[e("img",{src:d.selectedBook.img,class:"h-56 w-fit object-cover overflow-hidden rounded-md"},null,8,xe),e("div",ke,[e("div",null,[ye,e("div",null,o(d.selectedBook.kr),1)]),e("div",null,[$e,e("div",null,o(d.selectedBook.jp),1)]),d.selectedBook.dc?(u(),_("div",Be,[Ce,c(B,{variant:"outline",onClick:v[0]||(v[0]=f=>("navigateTo"in d?d.navigateTo:x(oe))(`/book/board/${d.selectedBook.kr}`))},{default:r(()=>[y(o(d.selectedBook.kr)+" 게시판으로 이동 ",1)]),_:1})])):Q("",!0)])]),(u(!0),_($,null,D(d.wiki,(f,q)=>(u(),_("div",je,[e("div",De,o(q+1)+". "+o(f==null?void 0:f.title),1),e("div",null,o(f==null?void 0:f.content),1)]))),256))])]),_:1})]),_:1},8,["open"])}}}),Te={class:"flex flex-col p-4 gap-4 w-full"},qe={class:"flex-col flex gap-4"},Le={class:"w-full flex flex-col gap-1"},Ve=e("div",null,[e("div",{class:"font-bold text-3xl"},"시리즈"),e("div",null,"시리즈의 전체 판매량 누적")],-1),Ne={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},Se={key:0},We=["onClick"],Fe={class:"shrink-0"},He=["src"],Ue={class:"grow-[1]"},Ie={class:"font-bold"},Ee={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Je={class:"text-xs"},Ke={class:"w-full flex flex-col gap-1"},Me=e("div",null,[e("div",{class:"font-bold text-3xl"},"단행본"),e("div",null,"단행본 전체 판매량 누적")],-1),Oe={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},Re={key:0},Ye={class:"flex flex-col w-40"},ze={class:"shrink-0"},Ae=["src"],Pe={class:"grow-[1]"},Qe={class:"font-bold"},Xe={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Ze={class:"text-xs"},rl=P({__name:"chart",setup(X){const m=h("all");async function G(l){m.value=l,await f(),await q(),await E(),B.value=[{title:"week",단행본:v.value.data,시리즈:i.value.series},{title:"month",단행본:p.value.data,시리즈:i.value.week},{title:"year",단행본:w.value.data,시리즈:i.value.year}]}const d=h(V()),v=h({data:[],error:""}),p=h({data:[],error:""}),w=h({data:[],error:""}),i=h({series:{},week:{},year:{}}),B=h([{title:"week",단행본:[],시리즈:[]},{title:"month",단행본:[],시리즈:[]},{title:"year",단행본:[],시리즈:[]}]),T=h({}),k=ie(()=>m.value==="all"?[]:de(m.value).map(l=>l.kr));async function f(){let l=F().value.from("book").select().order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),v.value.data.length===0?l=l.eq("date",V(1)):l=l.eq("date",d.value),v.value=await l,v.value.data=await H(v.value.data),i.value.series=N(v.value.data),i.value.series=await U(i.value.series)}async function q(){let l=F().value.from("book").select().gte("date",V(4)).lte("date",d.value).order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),p.value=await l,p.value.data=J(p.value.data),p.value.data=await H(p.value.data),i.value.week=N(p.value.data),i.value.week=await U(i.value.week)}async function E(){let l=F().value.from("book").select().gte("date",V(52)).lte("date",d.value).order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),w.value=await l,w.value.data=J(w.value.data),w.value.data=await H(w.value.data),i.value.year=N(w.value.data),i.value.year=await U(i.value.year)}function J(l){return K(l.reduce((n,a)=>(n.find(g=>g.jp===a.jp&&g.booknum===a.booknum)||n.push({jp:a.jp,booknum:a.booknum,kr:a.kr,img:a.img,sales:a.sales,dc:a.dc}),n),[]))}function N(l){return K(l.reduce((n,a)=>{const C=n.find(g=>g.jp===a.jp);return C?C.sales+=a.sales:n.push({jp:a.jp,kr:a.kr,img:a.img,sales:a.sales,dc:a.dc}),n},[]))}function K(l){return l.sort((n,a)=>a.sales-n.sales)}re(async()=>{await f(),await q(),await E(),B.value=[{title:"week",단행본:v.value.data,시리즈:i.value.series},{title:"month",단행본:p.value.data,시리즈:i.value.week},{title:"year",단행본:w.value.data,시리즈:i.value.year}]});const L=h(!1),M=h([]);async function Z(l){T.value=l;const n=l.kr,{data:a}=await we(`/api/namuWiki/${n}`,"$sGCsx3DkoJ");M.value=a.value,L.value=!0}return(l,n)=>{const a=Ge,C=ve,g=_e,O=fe,R=me,b=pe;return u(),_($,null,[c(a,{open:x(L),wiki:x(M),selectedBook:x(T),"onUpdate:open":n[0]||(n[0]=t=>L.value=!x(L))},null,8,["open","wiki","selectedBook"]),e("div",Te,[c(C,{title:"책 차트",description:"책의 차트를 보여줍니다."}),c(R,{class:"w-full overflow-x-scroll",modelValue:x(m),"onUpdate:modelValue":n[2]||(n[2]=t=>ce(m)?m.value=t:null)},{default:r(()=>[c(O,null,{default:r(()=>[c(g,{value:"all",onClick:n[1]||(n[1]=t=>G("all"))},{default:r(()=>[y(" 전체 ")]),_:1}),(u(!0),_($,null,D(("uniqueGenreByGenre"in l?l.uniqueGenreByGenre:x(ue))(),t=>(u(),I(g,{value:t.genre_name,onClick:S=>G(t.genre_name)},{default:r(()=>[y(o(t.genre_name),1)]),_:2},1032,["value","onClick"]))),256))]),_:1})]),_:1},8,["modelValue"]),c(R,{"default-value":"month",class:"w-full"},{default:r(()=>[c(O,null,{default:r(()=>[c(g,{value:"week"},{default:r(()=>[y(" 이번주 ")]),_:1}),c(g,{value:"month"},{default:r(()=>[y(" 4주간 ")]),_:1}),c(g,{value:"year"},{default:r(()=>[y(" 1년간 ")]),_:1})]),_:1}),(u(!0),_($,null,D(x(B),t=>(u(),I(b,{value:t.title},{default:r(()=>{var S,Y,z,A;return[e("div",qe,[e("div",Le,[Ve,e("div",Ne,[((S=t==null?void 0:t.시리즈)==null?void 0:S.length)==0?(u(),_("div",Se,o(t.title=="week"?"이번주":t.title=="month"?"한달간":"1년간")+"의 "+o(x(m))+" 장르의 시리즈에 집계된 데이터가 없습니다. ",1)):(u(!0),_($,{key:1},D((Y=t==null?void 0:t.시리즈)==null?void 0:Y.slice(0,20),(s,W)=>{var j;return u(),_("div",null,[e("div",{class:"flex flex-col w-40 cursor-pointer",onClick:be=>Z(s)},[e("div",Fe,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:s==null?void 0:s.img},null,8,He)]),e("div",Ue,[e("div",null,[e("div",Ie,o(W+1)+" 위",1)]),e("div",null,[e("div",Ee,o(s==null?void 0:s.kr),1)]),e("div",Je," 판매량 "+o((j=s==null?void 0:s.sales)==null?void 0:j.toLocaleString()),1)])],8,We)])}),256))])]),e("div",Ke,[Me,e("div",Oe,[((z=t==null?void 0:t.단행본)==null?void 0:z.length)==0?(u(),_("div",Re,o(t.title=="week"?"이번주":t.title=="month"?"한달간":"1년간")+"의 "+o(x(m))+" 장르의 단행본에 집계된 데이터가 없습니다. ",1)):Q("",!0),(u(!0),_($,null,D((A=t==null?void 0:t.단행본)==null?void 0:A.slice(0,20),(s,W)=>{var j;return u(),_("div",null,[e("div",Ye,[e("div",ze,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:s==null?void 0:s.img},null,8,Ae)]),e("div",Pe,[e("div",null,[e("div",Qe,o(W+1)+" 위",1)]),e("div",null,[e("div",Xe,o(s==null?void 0:s.kr)+" "+o(s==null?void 0:s.booknum),1)]),e("div",Ze," 판매량 "+o((j=s==null?void 0:s.sales)==null?void 0:j.toLocaleString()),1)])])])}),256))])])])]}),_:2},1032,["value"]))),256))]),_:1})])],64)}}});export{rl as default};
