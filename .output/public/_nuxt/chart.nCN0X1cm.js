import{_ as Y,a as I,b as Q,c as X,d as Z}from"./DialogContent.vue.ZaJoSwHi.js";import{_ as ee,d as se,K as te,c as P,W as le,N as ae,H as ne}from"./index.Ose1InN1.js";import{n as y,o,q as B,w as n,d as $,b as u,a as e,t as r,c as h,B as oe,F as T,A as b,C as L,D as ie,E as ce,x as d,G as z,r as g,s as re,z as S}from"./entry.WZMBoPIH.js";import{_ as de}from"./Header.vue.5TME5-XT.js";import{g as V}from"./book.3MwajxLC.js";import{u as ue}from"./fetch.dxlEW_Sd.js";import"./createLucideIcon.KBboI1Vi.js";const _e={class:"flex flex-col gap-4"},fe={class:"flex gap-4"},pe=["src"],ve={class:"flex flex-col gap-4"},me=e("div",{class:"text-sm font-bold"},"kr",-1),ge=e("div",{class:"text-sm font-bold"},"jp",-1),he={key:0,class:"flex flex-col gap-1"},xe=e("div",{class:"text-sm font-bold"},"게시판으로",-1),we={class:"flex flex-col gap-1"},$e={class:"text-3xl font-bold"},ye=y({__name:"namuWiki",props:{open:{type:Boolean},wiki:{},selectedBook:{}},emits:["update:open"],setup(v,{emit:a}){const i=a;return(l,_)=>{const f=Y,k=I,N=Q,H=ee,q=X,F=Z;return o(),B(F,{open:l.open,"onUpdate:open":_[0]||(_[0]=p=>i("update:open"))},{default:n(()=>[u(q,{class:"w-full max-w-7xl h-5/6 overflow-y-scroll"},{default:n(()=>[e("div",_e,[u(N,null,{default:n(()=>[u(f,null,{default:n(()=>[$("만화 상세")]),_:1}),u(k,null,{default:n(()=>[$(" 해당 내용은 나무위키에서 발췌한 것입니다. ")]),_:1})]),_:1}),e("div",fe,[e("img",{src:l.selectedBook.img,class:"h-56 w-fit object-cover overflow-hidden rounded-md"},null,8,pe),e("div",ve,[e("div",null,[me,e("div",null,r(l.selectedBook.kr),1)]),e("div",null,[ge,e("div",null,r(l.selectedBook.jp),1)]),l.selectedBook.dc?(o(),h("div",he,[xe,u(H,{variant:"outline"},{default:n(()=>[$(r(l.selectedBook.kr)+" 게시판으로 이동",1)]),_:1})])):oe("",!0)])]),(o(!0),h(T,null,b(l.wiki,(p,j)=>(o(),h("div",we,[e("div",$e,r(j+1)+". "+r(p==null?void 0:p.title),1),e("div",null,r(p==null?void 0:p.content),1)]))),256))])]),_:1})]),_:1},8,["open"])}}}),Be=y({__name:"Tabs",props:{defaultValue:{},orientation:{},dir:{},activationMode:{},modelValue:{},asChild:{type:Boolean},as:{}},emits:["update:modelValue"],setup(v,{emit:a}){const _=se(v,a);return(f,k)=>(o(),B(d(te),ie(ce(d(_))),{default:n(()=>[L(f.$slots,"default")]),_:3},16))}}),ke=y({__name:"TabsTrigger",props:{value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(v){const a=v;return(i,l)=>(o(),B(d(le),z(a,{class:d(P)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a.class)}),{default:n(()=>[L(i.$slots,"default")]),_:3},16,["class"]))}}),je=y({__name:"TabsList",props:{loop:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(v){const a=v;return(i,l)=>(o(),B(d(ae),z(a,{class:d(P)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a.class)}),{default:n(()=>[L(i.$slots,"default")]),_:3},16,["class"]))}}),Ce=y({__name:"TabsContent",props:{value:{},forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(v){const a=v;return(i,l)=>(o(),B(d(ne),z({class:d(P)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a.class)},a),{default:n(()=>[L(i.$slots,"default")]),_:3},16,["class"]))}}),De={class:"flex flex-col p-4 gap-4 w-full"},Te={class:"flex-col flex gap-4"},Ne={class:"w-full flex flex-col gap-1"},We=e("div",null,[e("div",{class:"font-bold text-3xl"},"시리즈"),e("div",null,"시리즈의 전체 판매량 누적")],-1),Se={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},Ve=["onClick"],be={class:"shrink-0"},Le=["src"],He={class:"grow-[1]"},qe={class:"font-bold"},Fe={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Me={class:"text-xs"},Pe={class:"w-full flex flex-col gap-1"},ze=e("div",null,[e("div",{class:"font-bold text-3xl"},"단행본"),e("div",null,"단행본 전체 판매량 누적")],-1),Ee={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},Ge={class:"flex flex-col w-40"},Ke={class:"shrink-0"},Ue=["src"],Ae={class:"grow-[1]"},Je={class:"font-bold"},Oe={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Re={class:"text-xs"},ls=y({__name:"chart",setup(v){const a=g(V()),i=g({data:[],error:""}),l=g({data:[],error:""}),_=g({data:[],error:""}),f=g({series:{},week:{},year:{}}),k=g([{title:"week",단행본:[],시리즈:[]},{title:"month",단행본:[],시리즈:[]},{title:"year",단행본:[],시리즈:[]}]),N=g({});async function H(){i.value=await S().value.from("book").select().eq("date",a.value).order("sales",{ascending:!1}),i.value.data.length===0&&(i.value=await S().value.from("book").select().eq("date",V(1)).order("sales",{ascending:!1})),f.value.series=j(i.value.data)}async function q(){l.value=await S().value.from("book").select().gte("date",V(4)).lte("date",a.value).order("sales",{ascending:!1}),l.value.data=p(l.value.data),f.value.week=j(l.value.data)}async function F(){_.value=await S().value.from("book").select().gte("date",V(52)).lte("date",a.value).order("sales",{ascending:!1}),_.value.data=p(_.value.data),f.value.year=j(_.value.data)}function p(m){return E(m.reduce((c,t)=>(c.find(x=>x.jp===t.jp&&x.booknum===t.booknum)||c.push({jp:t.jp,booknum:t.booknum,kr:t.kr,img:t.img,sales:t.sales,dc:t.dc}),c),[]))}function j(m){return E(m.reduce((c,t)=>{const C=c.find(x=>x.jp===t.jp);return C?C.sales+=t.sales:c.push({jp:t.jp,kr:t.kr,img:t.img,sales:t.sales,dc:t.dc}),c},[]))}function E(m){return m.sort((c,t)=>t.sales-c.sales)}re(async()=>{await H(),await q(),await F(),k.value=[{title:"week",단행본:i.value.data,시리즈:f.value.series},{title:"month",단행본:l.value.data,시리즈:f.value.week},{title:"year",단행본:_.value.data,시리즈:f.value.year}]});const W=g(!1),G=g([]);async function A(m){N.value=m;const c=m.kr,{data:t}=await ue(`/api/namuWiki/${c}`,"$sGCsx3DkoJ");G.value=t.value,W.value=!0}return(m,c)=>{const t=ye,C=de,x=ke,J=je,O=Ce,R=Be;return o(),h(T,null,[u(t,{open:d(W),wiki:d(G),selectedBook:d(N),"onUpdate:open":c[0]||(c[0]=w=>W.value=!d(W))},null,8,["open","wiki","selectedBook"]),e("div",De,[u(C,{title:"책 차트",description:"책의 차트를 보여줍니다."}),u(R,{"default-value":"week",class:"w-full"},{default:n(()=>[u(J,null,{default:n(()=>[u(x,{value:"week"},{default:n(()=>[$(" 이번주 ")]),_:1}),u(x,{value:"month"},{default:n(()=>[$(" 4주간 ")]),_:1}),u(x,{value:"year"},{default:n(()=>[$(" 1년간 ")]),_:1})]),_:1}),(o(!0),h(T,null,b(d(k),w=>(o(),B(O,{value:w.title},{default:n(()=>{var K,U;return[e("div",Te,[e("div",Ne,[We,e("div",Se,[(o(!0),h(T,null,b((K=w==null?void 0:w.시리즈)==null?void 0:K.slice(0,20),(s,M)=>{var D;return o(),h("div",null,[e("div",{class:"flex flex-col w-40 cursor-pointer",onClick:Ye=>A(s)},[e("div",be,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:s==null?void 0:s.img},null,8,Le)]),e("div",He,[e("div",null,[e("div",qe,r(M+1)+" 위",1)]),e("div",null,[e("div",Fe,r(s==null?void 0:s.kr),1)]),e("div",Me," 판매량 "+r((D=s==null?void 0:s.sales)==null?void 0:D.toLocaleString()),1)])],8,Ve)])}),256))])]),e("div",Pe,[ze,e("div",Ee,[(o(!0),h(T,null,b((U=w==null?void 0:w.단행본)==null?void 0:U.slice(0,20),(s,M)=>{var D;return o(),h("div",null,[e("div",Ge,[e("div",Ke,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:s==null?void 0:s.img},null,8,Ue)]),e("div",Ae,[e("div",null,[e("div",Je,r(M+1)+" 위",1)]),e("div",null,[e("div",Oe,r(s==null?void 0:s.kr)+" "+r(s==null?void 0:s.booknum),1)]),e("div",Re," 판매량 "+r((D=s==null?void 0:s.sales)==null?void 0:D.toLocaleString()),1)])])])}),256))])])])]}),_:2},1032,["value"]))),256))]),_:1})])],64)}}});export{ls as default};
