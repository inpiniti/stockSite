import{_ as ee,a as le,b as se,c as te,d as ae}from"./DialogContent.vue.aczt2w-3.js";import{_ as ne}from"./index.GplCeoaG.js";import{f as K,o as u,J as L,w as r,b as d,a as e,d as y,t as o,c as f,i as m,aq as oe,Q as X,F as B,O as T,G as ie,K as re,a4 as ue,as as ce,r as x,C as de,g as ve,at as _e,T as fe,u as H,au as I,av as J,aw as me}from"./entry.da6Y4NAq.js";import{_ as pe}from"./Header.vue.IwZ-Wc4f.js";import{_ as ge,a as we,b as he}from"./TabsList.vue.eDmcjUBS.js";import{g as V}from"./book.Jn-fh3Jt.js";import{u as xe}from"./fetch.DuA0qw5G.js";const ke={class:"flex flex-col gap-4"},ye={class:"flex gap-4"},$e=["src"],Be={class:"flex flex-col gap-4"},Ce=e("div",{class:"text-sm font-bold"},"kr",-1),je=e("div",{class:"text-sm font-bold"},"jp",-1),De={key:0,class:"flex flex-col gap-1"},Te=e("div",{class:"text-sm font-bold"},"게시판으로",-1),Ge={class:"flex flex-col gap-1"},qe={class:"text-3xl font-bold"},Se=K({__name:"namuWiki",props:{open:{type:Boolean},wiki:{},selectedBook:{}},emits:["update:open"],setup(N,{emit:v}){const $=v;return(c,_)=>{const g=ee,w=le,i=se,C=ne,G=te,k=ae;return u(),L(k,{open:c.open,"onUpdate:open":_[1]||(_[1]=p=>$("update:open"))},{default:r(()=>[d(G,{class:"w-full max-w-7xl h-5/6 overflow-y-scroll"},{default:r(()=>[e("div",ke,[d(i,null,{default:r(()=>[d(g,null,{default:r(()=>[y("만화 상세")]),_:1}),d(w,null,{default:r(()=>[y(" 해당 내용은 나무위키에서 발췌한 것입니다. ")]),_:1})]),_:1}),e("div",ye,[e("img",{src:c.selectedBook.img,class:"h-56 w-fit object-cover overflow-hidden rounded-md"},null,8,$e),e("div",Be,[e("div",null,[Ce,e("div",null,o(c.selectedBook.kr),1)]),e("div",null,[je,e("div",null,o(c.selectedBook.jp),1)]),c.selectedBook.dc?(u(),f("div",De,[Te,d(C,{variant:"outline",onClick:_[0]||(_[0]=p=>("navigateTo"in c?c.navigateTo:m(oe))(`/book/board/${c.selectedBook.kr}`))},{default:r(()=>[y(o(c.selectedBook.kr)+" 게시판으로 이동 ",1)]),_:1})])):X("",!0)])]),(u(!0),f(B,null,T(c.wiki,(p,q)=>(u(),f("div",Ge,[e("div",qe,o(q+1)+". "+o(p==null?void 0:p.title),1),e("div",null,o(p==null?void 0:p.content),1)]))),256))])]),_:1})]),_:1},8,["open"])}}}),Ve=K({__name:"TabsContent",props:{value:{},forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(N){const v=N;return($,c)=>(u(),L(m(ce),re({class:m(ue)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",v.class)},v),{default:r(()=>[ie($.$slots,"default")]),_:3},16,["class"]))}}),Le={class:"flex flex-col p-4 gap-4 w-full"},Ne={class:"flex-col flex gap-4"},We={class:"w-full flex flex-col gap-1"},Fe=e("div",null,[e("div",{class:"font-bold text-3xl"},"시리즈"),e("div",null,"시리즈의 전체 판매량 누적")],-1),Ue={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},He={key:0},Ie=["onClick"],Je={class:"shrink-0"},Ke=["src"],Me={class:"grow-[1]"},Oe={class:"font-bold"},Ee={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Pe={class:"text-xs"},Qe={class:"w-full flex flex-col gap-1"},Re=e("div",null,[e("div",{class:"font-bold text-3xl"},"단행본"),e("div",null,"단행본 전체 판매량 누적")],-1),Ye={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},ze={key:0},Ae={class:"flex flex-col w-40"},Xe={class:"shrink-0"},Ze=["src"],be={class:"grow-[1]"},el={class:"font-bold"},ll={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},sl={class:"text-xs"},dl=K({__name:"chart",setup(N){const v=x("all");async function $(l){v.value=l,await p(),await q(),await M(),C.value=[{title:"week",단행본:_.value.data,시리즈:i.value.series},{title:"month",단행본:g.value.data,시리즈:i.value.week},{title:"year",단행본:w.value.data,시리즈:i.value.year}]}const c=x(V()),_=x({data:[],error:""}),g=x({data:[],error:""}),w=x({data:[],error:""}),i=x({series:{},week:{},year:{}}),C=x([{title:"week",단행본:[],시리즈:[]},{title:"month",단행본:[],시리즈:[]},{title:"year",단행본:[],시리즈:[]}]),G=x({}),k=de(()=>v.value==="all"?[]:me(v.value).map(l=>l.kr));async function p(){let l=H().value.from("book").select().order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),_.value.data.length===0?l=l.eq("date",V(1)):l=l.eq("date",c.value),_.value=await l,_.value.data=await I(_.value.data),i.value.series=W(_.value.data),i.value.series=await J(i.value.series)}async function q(){let l=H().value.from("book").select().gte("date",V(4)).lte("date",c.value).order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),g.value=await l,g.value.data=O(g.value.data),g.value.data=await I(g.value.data),i.value.week=W(g.value.data),i.value.week=await J(i.value.week)}async function M(){let l=H().value.from("book").select().gte("date",V(52)).lte("date",c.value).order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),w.value=await l,w.value.data=O(w.value.data),w.value.data=await I(w.value.data),i.value.year=W(w.value.data),i.value.year=await J(i.value.year)}function O(l){return E(l.reduce((n,a)=>(n.find(h=>h.jp===a.jp&&h.booknum===a.booknum)||n.push({jp:a.jp,booknum:a.booknum,kr:a.kr,img:a.img,sales:a.sales,dc:a.dc}),n),[]))}function W(l){return E(l.reduce((n,a)=>{const j=n.find(h=>h.jp===a.jp);return j?j.sales+=a.sales:n.push({jp:a.jp,kr:a.kr,img:a.img,sales:a.sales,dc:a.dc}),n},[]))}function E(l){return l.sort((n,a)=>a.sales-n.sales)}ve(async()=>{await p(),await q(),await M(),C.value=[{title:"week",단행본:_.value.data,시리즈:i.value.series},{title:"month",단행본:g.value.data,시리즈:i.value.week},{title:"year",단행본:w.value.data,시리즈:i.value.year}]});const S=x(!1),P=x([]);async function Z(l){G.value=l;const n=l.kr,{data:a}=await xe(`/api/namuWiki/${n}`,"$sGCsx3DkoJ");P.value=a.value,S.value=!0}return(l,n)=>{const a=Se,j=pe,h=ge,Q=we,R=he,b=Ve;return u(),f(B,null,[d(a,{open:m(S),wiki:m(P),selectedBook:m(G),"onUpdate:open":n[0]||(n[0]=s=>S.value=!m(S))},null,8,["open","wiki","selectedBook"]),e("div",Le,[d(j,{title:"책 차트",description:"책의 차트를 보여줍니다."}),d(R,{class:"w-full overflow-x-scroll",modelValue:m(v),"onUpdate:modelValue":n[2]||(n[2]=s=>fe(v)?v.value=s:null)},{default:r(()=>[d(Q,null,{default:r(()=>[d(h,{value:"all",onClick:n[1]||(n[1]=s=>$("all"))},{default:r(()=>[y(" 전체 ")]),_:1}),(u(!0),f(B,null,T(("uniqueGenreByGenre"in l?l.uniqueGenreByGenre:m(_e))(),s=>(u(),L(h,{value:s.genre_name,onClick:F=>$(s.genre_name)},{default:r(()=>[y(o(s.genre_name),1)]),_:2},1032,["value","onClick"]))),256))]),_:1})]),_:1},8,["modelValue"]),d(R,{"default-value":"month",class:"w-full"},{default:r(()=>[d(Q,null,{default:r(()=>[d(h,{value:"week"},{default:r(()=>[y(" 이번주 ")]),_:1}),d(h,{value:"month"},{default:r(()=>[y(" 4주간 ")]),_:1}),d(h,{value:"year"},{default:r(()=>[y(" 1년간 ")]),_:1})]),_:1}),(u(!0),f(B,null,T(m(C),s=>(u(),L(b,{value:s.title},{default:r(()=>{var F,Y,z,A;return[e("div",Ne,[e("div",We,[Fe,e("div",Ue,[((F=s==null?void 0:s.시리즈)==null?void 0:F.length)==0?(u(),f("div",He,o(s.title=="week"?"이번주":s.title=="month"?"한달간":"1년간")+"의 "+o(m(v))+" 장르의 시리즈에 집계된 데이터가 없습니다. ",1)):(u(!0),f(B,{key:1},T((Y=s==null?void 0:s.시리즈)==null?void 0:Y.slice(0,20),(t,U)=>{var D;return u(),f("div",null,[e("div",{class:"flex flex-col w-40 cursor-pointer",onClick:tl=>Z(t)},[e("div",Je,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:t==null?void 0:t.img},null,8,Ke)]),e("div",Me,[e("div",null,[e("div",Oe,o(U+1)+" 위",1)]),e("div",null,[e("div",Ee,o(t==null?void 0:t.kr),1)]),e("div",Pe," 판매량 "+o((D=t==null?void 0:t.sales)==null?void 0:D.toLocaleString()),1)])],8,Ie)])}),256))])]),e("div",Qe,[Re,e("div",Ye,[((z=s==null?void 0:s.단행본)==null?void 0:z.length)==0?(u(),f("div",ze,o(s.title=="week"?"이번주":s.title=="month"?"한달간":"1년간")+"의 "+o(m(v))+" 장르의 단행본에 집계된 데이터가 없습니다. ",1)):X("",!0),(u(!0),f(B,null,T((A=s==null?void 0:s.단행본)==null?void 0:A.slice(0,20),(t,U)=>{var D;return u(),f("div",null,[e("div",Ae,[e("div",Xe,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:t==null?void 0:t.img},null,8,Ze)]),e("div",be,[e("div",null,[e("div",el,o(U+1)+" 위",1)]),e("div",null,[e("div",ll,o(t==null?void 0:t.kr)+" "+o(t==null?void 0:t.booknum),1)]),e("div",sl," 판매량 "+o((D=t==null?void 0:t.sales)==null?void 0:D.toLocaleString()),1)])])])}),256))])])])]}),_:2},1032,["value"]))),256))]),_:1})])],64)}}});export{dl as default};
