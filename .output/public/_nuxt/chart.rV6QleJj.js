import{_ as ee,a as le,b as te,c as se,d as ae}from"./DialogContent.vue.SdVrpw_C.js";import{_ as ne}from"./index.bMcRmAll.js";import{f as A,o as r,J as I,w as u,b as c,a as e,d as y,t as o,c as _,i as x,ar as oe,Q as P,F as $,O as D,r as h,C as ie,g as ue,at as re,T as ce,u as F,au as U,av as H,aw as de}from"./entry.4ne-HkFC.js";import{_ as ve}from"./Header.vue.DcuxAkjP.js";import{_ as _e,a as fe,b as me}from"./TabsList.vue.s_TnXju-.js";import{_ as pe}from"./TabsContent.vue.xeAooamL.js";import{g as L}from"./book.Jn-fh3Jt.js";import{u as we}from"./fetch.XvOfu5jQ.js";const ge={class:"flex flex-col gap-4"},he={class:"flex gap-4"},xe=["src"],ke={class:"flex flex-col gap-4"},ye=e("div",{class:"text-sm font-bold"},"kr",-1),$e=e("div",{class:"text-sm font-bold"},"jp",-1),Be={key:0,class:"flex flex-col gap-1"},Ce=e("div",{class:"text-sm font-bold"},"게시판으로",-1),je={class:"flex flex-col gap-1"},De={class:"text-3xl font-bold"},Te=A({__name:"namuWiki",props:{open:{type:Boolean},wiki:{},selectedBook:{}},emits:["update:open"],setup(X,{emit:m}){const T=m;return(d,v)=>{const p=ee,w=le,i=te,B=ne,G=se,k=ae;return r(),I(k,{open:d.open,"onUpdate:open":v[1]||(v[1]=f=>T("update:open"))},{default:u(()=>[c(G,{class:"w-full max-w-7xl h-5/6 overflow-y-scroll"},{default:u(()=>[e("div",ge,[c(i,null,{default:u(()=>[c(p,null,{default:u(()=>[y("만화 상세")]),_:1}),c(w,null,{default:u(()=>[y(" 해당 내용은 나무위키에서 발췌한 것입니다. ")]),_:1})]),_:1}),e("div",he,[e("img",{src:d.selectedBook.img,class:"h-56 w-fit object-cover overflow-hidden rounded-md"},null,8,xe),e("div",ke,[e("div",null,[ye,e("div",null,o(d.selectedBook.kr),1)]),e("div",null,[$e,e("div",null,o(d.selectedBook.jp),1)]),d.selectedBook.dc?(r(),_("div",Be,[Ce,c(B,{variant:"outline",onClick:v[0]||(v[0]=f=>("navigateTo"in d?d.navigateTo:x(oe))(`/book/board/${d.selectedBook.kr}`))},{default:u(()=>[y(o(d.selectedBook.kr)+" 게시판으로 이동 ",1)]),_:1})])):P("",!0)])]),(r(!0),_($,null,D(d.wiki,(f,q)=>(r(),_("div",je,[e("div",De,o(q+1)+". "+o(f==null?void 0:f.title),1),e("div",null,o(f==null?void 0:f.content),1)]))),256))])]),_:1})]),_:1},8,["open"])}}}),Ge={class:"flex flex-col p-4 gap-4 w-full"},qe={class:"flex-col flex gap-4"},Ve={class:"w-full flex flex-col gap-1"},Le=e("div",null,[e("div",{class:"font-bold text-3xl"},"시리즈"),e("div",null,"시리즈의 전체 판매량 누적")],-1),Ne={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},Se={key:0},We=["onClick"],Fe={class:"shrink-0"},Ue=["src"],He={class:"grow-[1]"},Ie={class:"font-bold"},Je={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Oe={class:"text-xs"},Ee={class:"w-full flex flex-col gap-1"},Ke=e("div",null,[e("div",{class:"font-bold text-3xl"},"단행본"),e("div",null,"단행본 전체 판매량 누적")],-1),Me={class:"border rounded-md p-4 flex flex-row gap-1 overflow-x-scroll"},Qe={key:0},Re={class:"flex flex-col w-40"},Ye={class:"shrink-0"},ze=["src"],Ae={class:"grow-[1]"},Pe={class:"font-bold"},Xe={class:"font-bold text-xs overflow-hidden whitespace-nowrap overflow-ellipsis"},Ze={class:"text-xs"},ul=A({__name:"chart",setup(X){const m=h("all");async function T(l){m.value=l,await f(),await q(),await J(),B.value=[{title:"week",단행본:v.value.data,시리즈:i.value.series},{title:"month",단행본:p.value.data,시리즈:i.value.week},{title:"year",단행본:w.value.data,시리즈:i.value.year}]}const d=h(L()),v=h({data:[],error:""}),p=h({data:[],error:""}),w=h({data:[],error:""}),i=h({series:{},week:{},year:{}}),B=h([{title:"week",단행본:[],시리즈:[]},{title:"month",단행본:[],시리즈:[]},{title:"year",단행본:[],시리즈:[]}]),G=h({}),k=ie(()=>m.value==="all"?[]:de(m.value).map(l=>l.kr));async function f(){let l=F().value.from("book").select().order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),v.value.data.length===0?l=l.eq("date",L(1)):l=l.eq("date",d.value),v.value=await l,v.value.data=await U(v.value.data),i.value.series=N(v.value.data),i.value.series=await H(i.value.series)}async function q(){let l=F().value.from("book").select().gte("date",L(4)).lte("date",d.value).order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),p.value=await l,p.value.data=O(p.value.data),p.value.data=await U(p.value.data),i.value.week=N(p.value.data),i.value.week=await H(i.value.week)}async function J(){let l=F().value.from("book").select().gte("date",L(52)).lte("date",d.value).order("sales",{ascending:!1});k.value.length>0&&(l=l.in("kr",k.value)),w.value=await l,w.value.data=O(w.value.data),w.value.data=await U(w.value.data),i.value.year=N(w.value.data),i.value.year=await H(i.value.year)}function O(l){return E(l.reduce((n,a)=>(n.find(g=>g.jp===a.jp&&g.booknum===a.booknum)||n.push({jp:a.jp,booknum:a.booknum,kr:a.kr,img:a.img,sales:a.sales,dc:a.dc}),n),[]))}function N(l){return E(l.reduce((n,a)=>{const C=n.find(g=>g.jp===a.jp);return C?C.sales+=a.sales:n.push({jp:a.jp,kr:a.kr,img:a.img,sales:a.sales,dc:a.dc}),n},[]))}function E(l){return l.sort((n,a)=>a.sales-n.sales)}ue(async()=>{await f(),await q(),await J(),B.value=[{title:"week",단행본:v.value.data,시리즈:i.value.series},{title:"month",단행본:p.value.data,시리즈:i.value.week},{title:"year",단행본:w.value.data,시리즈:i.value.year}]});const V=h(!1),K=h([]);async function Z(l){G.value=l;const n=l.kr,{data:a}=await we(`/api/namuWiki/${n}`,"$sGCsx3DkoJ");K.value=a.value,V.value=!0}return(l,n)=>{const a=Te,C=ve,g=_e,M=fe,Q=me,b=pe;return r(),_($,null,[c(a,{open:x(V),wiki:x(K),selectedBook:x(G),"onUpdate:open":n[0]||(n[0]=t=>V.value=!x(V))},null,8,["open","wiki","selectedBook"]),e("div",Ge,[c(C,{title:"책 차트",description:"책의 차트를 보여줍니다."}),c(Q,{class:"w-full overflow-x-scroll",modelValue:x(m),"onUpdate:modelValue":n[2]||(n[2]=t=>ce(m)?m.value=t:null)},{default:u(()=>[c(M,null,{default:u(()=>[c(g,{value:"all",onClick:n[1]||(n[1]=t=>T("all"))},{default:u(()=>[y(" 전체 ")]),_:1}),(r(!0),_($,null,D(("uniqueGenreByGenre"in l?l.uniqueGenreByGenre:x(re))(),t=>(r(),I(g,{value:t.genre_name,onClick:S=>T(t.genre_name)},{default:u(()=>[y(o(t.genre_name),1)]),_:2},1032,["value","onClick"]))),256))]),_:1})]),_:1},8,["modelValue"]),c(Q,{"default-value":"month",class:"w-full"},{default:u(()=>[c(M,null,{default:u(()=>[c(g,{value:"week"},{default:u(()=>[y(" 이번주 ")]),_:1}),c(g,{value:"month"},{default:u(()=>[y(" 4주간 ")]),_:1}),c(g,{value:"year"},{default:u(()=>[y(" 1년간 ")]),_:1})]),_:1}),(r(!0),_($,null,D(x(B),t=>(r(),I(b,{value:t.title},{default:u(()=>{var S,R,Y,z;return[e("div",qe,[e("div",Ve,[Le,e("div",Ne,[((S=t==null?void 0:t.시리즈)==null?void 0:S.length)==0?(r(),_("div",Se,o(t.title=="week"?"이번주":t.title=="month"?"한달간":"1년간")+"의 "+o(x(m))+" 장르의 시리즈에 집계된 데이터가 없습니다. ",1)):(r(!0),_($,{key:1},D((R=t==null?void 0:t.시리즈)==null?void 0:R.slice(0,20),(s,W)=>{var j;return r(),_("div",null,[e("div",{class:"flex flex-col w-40 cursor-pointer",onClick:be=>Z(s)},[e("div",Fe,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:s==null?void 0:s.img},null,8,Ue)]),e("div",He,[e("div",null,[e("div",Ie,o(W+1)+" 위",1)]),e("div",null,[e("div",Je,o(s==null?void 0:s.kr),1)]),e("div",Oe," 판매량 "+o((j=s==null?void 0:s.sales)==null?void 0:j.toLocaleString()),1)])],8,We)])}),256))])]),e("div",Ee,[Ke,e("div",Me,[((Y=t==null?void 0:t.단행본)==null?void 0:Y.length)==0?(r(),_("div",Qe,o(t.title=="week"?"이번주":t.title=="month"?"한달간":"1년간")+"의 "+o(x(m))+" 장르의 단행본에 집계된 데이터가 없습니다. ",1)):P("",!0),(r(!0),_($,null,D((z=t==null?void 0:t.단행본)==null?void 0:z.slice(0,20),(s,W)=>{var j;return r(),_("div",null,[e("div",Re,[e("div",Ye,[e("img",{class:"h-56 object-cover overflow-hidden rounded-md",src:s==null?void 0:s.img},null,8,ze)]),e("div",Ae,[e("div",null,[e("div",Pe,o(W+1)+" 위",1)]),e("div",null,[e("div",Xe,o(s==null?void 0:s.kr)+" "+o(s==null?void 0:s.booknum),1)]),e("div",Ze," 판매량 "+o((j=s==null?void 0:s.sales)==null?void 0:j.toLocaleString()),1)])])])}),256))])])])]}),_:2},1032,["value"]))),256))]),_:1})])],64)}}});export{ul as default};
